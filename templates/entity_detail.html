{% extends "base.html" %} {% block title %}{{ entity.name }} - Entity - Charlie{%
endblock %} {% block content %}
<div class="entity-detail-page">
    <header class="page-header">
        <nav class="breadcrumb">
            <a href="/">Home</a> → <a href="/entities">Entities</a> →
            <span>{{ entity.name }}</span>
        </nav>
    </header>

    <div class="entity-detail">
        <article class="entity-content">
            <header class="entity-header">
                <h1 class="entity-title">{{ entity.name }}</h1>
            </header>

        {% if entity.summary %}
        <div class="entity-summary">
            <p>{{ entity.summary }}</p>
        </div>
        {% endif %}

        <div class="entity-stats">
            <span class="stat-item">
                <strong>{{ timeline|length if timeline else 0 }}</strong>
                journal entr{{ 'ies' if timeline|length != 1 else 'y' }}
            </span>
            <span class="stat-item">
                <strong>{{ relationships|length if relationships else 0 }}</strong>
                related entit{{ 'ies' if relationships|length != 1 else 'y' }}
            </span>
            <span class="stat-item">
                <strong>{{ communities|length if communities else 0 }}</strong>
                communit{{ 'ies' if communities|length != 1 else 'y' }}
            </span>
        </div>

        {% if timeline %}
        <section class="entity-timeline">
            <h2>Journal Entries</h2>
            <p class="section-description">
                Entries from your journal that mention {{ entity.name }}
            </p>
            <div class="timeline-entries">
                {% for context in timeline %}
                <article class="timeline-entry">
                    <div class="entry-header">
                        <h3 class="entry-title">
                            <a href="/episodes/{{ context.episode_uuid }}">
                                {{ context.episode_title }}
                            </a>
                        </h3>
                        <time
                            class="entry-date"
                            datetime="{{ context.episode_date.isoformat() }}"
                        >
                            {{ context.episode_date.strftime('%B %d, %Y') }}
                        </time>
                    </div>
                    <p class="entry-excerpt">{{ context.excerpt }}</p>
                </article>
                {% endfor %}
            </div>
        </section>
        {% else %}
        <section class="entity-timeline">
            <h2>Journal Entries</h2>
            <p class="empty-message">No journal entries found mentioning {{ entity.name }}.</p>
        </section>
        {% endif %}

        <footer class="entity-footer">
            <a href="/" class="button-link">&larr; Back to Journal Entries</a>
        </footer>
        </article>

        <aside class="entity-sidebar">
            {% if relationships %}
            <div class="sidebar-panel">
                <h2>Related Entities</h2>
                <ul class="relationships-list">
                    {% for rel in relationships %}
                    <li class="relationship-item">
                        <a href="/entities/{{ rel.entity.uuid }}" class="entity-link">
                            {{ rel.entity.name }}
                        </a>
                        {% if rel.relationship_fact %}
                        <span class="relationship-fact">
                            {{ rel.relationship_fact }}
                        </span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if communities %}
            <div class="sidebar-panel">
                <h2>Communities</h2>
                <ul class="communities-list">
                    {% for community in communities %}
                    <li class="community-item">
                        <a href="/communities/{{ community.uuid }}" class="community-link">
                            {{ community.name }}
                        </a>
                        {% if community.member_count %}
                        <span class="community-meta">
                            {{ community.member_count }} members
                        </span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </aside>
    </div>
</div>
{% endblock %}
